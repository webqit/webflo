import{_ as a,c as n,o as l,a2 as e}from"./chunks/framework.9Uv4PgnO.js";const F=JSON.parse('{"title":"Webflo Routing","description":"","frontmatter":{},"headers":[],"relativePath":"docs/concepts/routing.md","filePath":"docs/concepts/routing.md"}'),o={name:"docs/concepts/routing.md"};function t(p,s,r,c,i,y){return l(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="webflo-routing" tabindex="-1">Webflo Routing <a class="header-anchor" href="#webflo-routing" aria-label="Permalink to &quot;Webflo Routing&quot;">​</a></h1><p>Functions come into play in Webflo when you need to dynamically handle requests. Routing defines how those requests map to functions in a Webflo application. It determines which handler responds to a given URL, how requests move across layers of the stack, and how each step in that process composes into a complete response.</p><h2 id="layout-convention" tabindex="-1">Layout Convention <a class="header-anchor" href="#layout-convention" aria-label="Permalink to &quot;Layout Convention&quot;">​</a></h2><p>In Webflo, <strong>your filesystem <em>is</em> the router</strong>. Each folder under <code>app/</code> corresponds to a segment in your application’s URL path, and each handler file in that folder defines what happens at that segment.</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">app/</span></span>
<span class="line"><span style="color:#BABED8;">├── handler.server.js                       →  /</span></span>
<span class="line"><span style="color:#BABED8;">├── about/handler.server.js                 →  /about</span></span>
<span class="line"><span style="color:#BABED8;">├── products/handler.server.js              →  /products</span></span>
<span class="line"><span style="color:#BABED8;">└── products/stickers/handler.server.js     →  /products/stickers</span></span></code></pre></div><p>Handlers can be designed to match any segment using wildcards. A folder named <code>-</code> acts as a catch-all at its level.</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">app/</span></span>
<span class="line"><span style="color:#BABED8;">├── -/handler.server.js                     →  /*</span></span>
<span class="line"><span style="color:#BABED8;">└── products/-/handler.server.js            →  /products/*</span></span></code></pre></div><h2 id="handlers" tabindex="-1">Handlers <a class="header-anchor" href="#handlers" aria-label="Permalink to &quot;Handlers&quot;">​</a></h2><p>Handlers are standard JavaScript functions that process requests and return responses. They share the same base signature:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> fetch</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Welcome to Webflo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>A route may provide <strong><a href="/api/webflo-routing/handler#naming">named exports</a></strong> to map specific HTTP requests to specific handlers:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#82AAFF;"> GET</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span><span style="color:#676E95;font-style:italic;"> /* ... */</span><span style="color:#89DDFF;"> }</span></span></code></pre></div><p>Handlers are fully covered in the <a href="/api/webflo-routing/handler">Handler API</a> section, but below is an overview.</p><h3 id="parameters" tabindex="-1">Parameters <a class="header-anchor" href="#parameters" aria-label="Permalink to &quot;Parameters&quot;">​</a></h3><p>Parameters recieved include:</p><table tabindex="0"><thead><tr><th style="text-align:left;">Parameter</th><th style="text-align:left;">Type</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>event</code></td><td style="text-align:left;"><a href="/api/webflo-routing/HttpEvent"><code>HttpEvent</code></a></td><td style="text-align:left;">Current HTTP event.</td></tr><tr><td style="text-align:left;"><code>next</code></td><td style="text-align:left;"><a href="/api/webflo-routing/handler/next"><code>next</code></a></td><td style="text-align:left;">Control delegation function.</td></tr><tr><td style="text-align:left;"><code>fetch</code></td><td style="text-align:left;"><a href="/api/webflo-routing/handler/fetch"><code>fetch</code></a></td><td style="text-align:left;">Context-aware fetch API for inbound and outbound calls.</td></tr></tbody></table><h3 id="contextual-parameters" tabindex="-1">Contextual Parameters <a class="header-anchor" href="#contextual-parameters" aria-label="Permalink to &quot;Contextual Parameters&quot;">​</a></h3><p>Within a handler, contextual properties are available on the <a href="/api/webflo-routing/handler#the-this-context"><code>this</code></a> and <a href="/api/webflo-routing/handler/next"><code>next</code></a> interfaces:</p><table tabindex="0"><thead><tr><th style="text-align:left;">Property</th><th style="text-align:left;">Type</th><th>Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>next.stepname</code></td><td style="text-align:left;"><code>string</code></td><td>The name of the next segment in the URL.</td></tr><tr><td style="text-align:left;"><code>next.pathname</code></td><td style="text-align:left;"><code>string</code></td><td>The full path <em>beyond</em> the the active step.</td></tr><tr><td style="text-align:left;"><code>this.stepname</code></td><td style="text-align:left;"><code>string</code></td><td>The current directory segment being handled.</td></tr><tr><td style="text-align:left;"><code>this.pathname</code></td><td style="text-align:left;"><code>string</code></td><td>The current URL pathname <em>up to</em> the active step.</td></tr><tr><td style="text-align:left;"><code>this.filename</code></td><td style="text-align:left;"><code>string</code></td><td>The filename of the executing handler (server-side only)</td></tr></tbody></table><p>Use these for conditional delegation, or per-segment rules.</p><h3 id="your-first-handler-again" tabindex="-1">Your First Handler (Again) <a class="header-anchor" href="#your-first-handler-again" aria-label="Permalink to &quot;Your First Handler (Again)&quot;">​</a></h3><p>Your application&#39;s routes may be designed with as many or as few handlers as desired.<br> The contextual parameters <code>next.stepname</code> and <code>next.pathname</code> totally make it possible to fit routing logic into a single handler.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // For http://localhost:3000/products</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pathname</span><span style="color:#89DDFF;"> ===</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // For http://localhost:3000/products/stickers</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pathname</span><span style="color:#89DDFF;"> ===</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">products/stickers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Stickers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Should we later support other URLs like static assets http://localhost:3000/logo.png</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pathname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // For the root URL http://localhost:3000</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Home</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>But the power of Webflo routing model really shines as you spread out to more handlers.</p><h2 id="the-delegation-model" tabindex="-1">The Delegation Model <a class="header-anchor" href="#the-delegation-model" aria-label="Permalink to &quot;The Delegation Model&quot;">​</a></h2><p>In Webflo, nested URLs such as <code>/products/stickers</code> don’t directly invoke their corresponding leaf handler (<code>app/products/stickers/handler.server.js</code>) in isolation. Instead, requests are handled <strong>step-by-step — from parent to child</strong>, forming a <strong>pipeline</strong>.</p><p>The <code>next()</code> function is how a handler delegates control to the next step in that pipeline.</p><p>This is simulated below for a URL like <code>/products/stickers</code>.<br> Each handler uses <code>next()</code> to delegate, and the final step returns the response.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">┌──────────┐   ┌──────────────┐    ┌──────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ app</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">     │ → │ products</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">    │ →  │ stickers</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">        │</span></span>
<span class="line"><span style="color:#BABED8;">│ handler  │   │ handler      │    │ handler          │</span></span>
<span class="line"><span style="color:#BABED8;">│ </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()   │   │ </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()       │    │ </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;"> {}</span><span style="color:#BABED8;">        │</span></span>
<span class="line"><span style="color:#BABED8;">└──────────┘   └──────────────┘    └──────────────────┘</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Home</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/products/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/products/stickers/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> ()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Stickers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ul><li>The request enters at the top level (<code>app/handler.server.js</code>).</li><li>Each handler may perform logic and either return a response or call <code>next()</code>.</li><li><code>next()</code> advances the request to the next directory level in the URL.</li><li>Delegation stops when there are no further segments (<code>next.stepname</code> is falsy).</li></ul><h3 id="internal-rerouting" tabindex="-1">Internal Rerouting <a class="header-anchor" href="#internal-rerouting" aria-label="Permalink to &quot;Internal Rerouting&quot;">​</a></h3><p>Beyond the default parent-child flow, a handler can explicitly <strong>reroute</strong> a request to another path within the app by calling <code>next(path)</code> or <code>next(context, path)</code>.</p><p>This is simulated below for a URL like <code>/products/stickers</code>.<br> Here, the root handler conditionally reroutes the request to <code>/api/inventory</code>, all within the same app.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#89DDFF;"> ===</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">        const</span><span style="color:#BABED8;"> inventory</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/inventory?range=7d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> ...</span><span style="color:#BABED8;">inventory</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Home</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">┌──────────┐   ┌──────────────┐    ┌──────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ app</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">     │─┐ │ products</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">    │ →  │ stickers</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">        │</span></span>
<span class="line"><span style="color:#BABED8;">│ handler  │ │ │ handler      │    │ handler          │</span></span>
<span class="line"><span style="color:#BABED8;">│ </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">(▼)  │ │ │              │    │                  │</span></span>
<span class="line"><span style="color:#BABED8;">└──────────┘ │ └──────────────┘    └──────────────────┘</span></span>
<span class="line"><span style="color:#BABED8;">             │</span></span>
<span class="line"><span style="color:#BABED8;">             │ (internal call)</span></span>
<span class="line"><span style="color:#BABED8;">             ▼</span></span>
<span class="line"><span style="color:#BABED8;">┌──────────┐   ┌──────────────┐    ┌──────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ app</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">     │ → │ api</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">         │ →  │ inventory</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">       │</span></span>
<span class="line"><span style="color:#BABED8;">│ handler  │   │ handler      │    │ handler          │</span></span>
<span class="line"><span style="color:#BABED8;">│ </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()   │   │ </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()       │    │ </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;"> {}</span><span style="color:#BABED8;">        │</span></span>
<span class="line"><span style="color:#BABED8;">└──────────┘   └──────────────┘    └──────────────────┘</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/api/inventory/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> range</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">searchParams</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">range</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> result</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#BABED8;"> db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#89DDFF;">        \`</span><span style="color:#C3E88D;">SELECT * FROM inventory WHERE date_added &lt; $1</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#BABED8;">range</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Inventory</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> result</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>The rerouted request travels through the normal routing tree (<code>app/</code> → <code>api/</code> → <code>inventory/</code>) as if it had originated normally.</p><p>A relative path (e.g., <code>next(&#39;./api/inventory?range=7d&#39;)</code>) may be used to bypass lineage. But this must be done intentionally: deeper routes often inherit authentication or other contexts that should not be bypassed.</p><p>This technique enables <strong>in-app data composition</strong> — using existing route logic without additional network requests.</p><h3 id="request-and-response-rewriting" tabindex="-1">Request and Response Rewriting <a class="header-anchor" href="#request-and-response-rewriting" aria-label="Permalink to &quot;Request and Response Rewriting&quot;">​</a></h3><p>At any stage, a handler may rewrite parts of a request or modify the returned response before passing it on. This allows dynamic query shaping, conditional caching, or on-the-fly header injection.</p><p>This is simulated below for a scenario where the parent adds a parameter (<code>p=3</code>) to the child route, and then post-processes the response to set a custom header.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/products/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Clone the request with a new query param</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> url</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> new</span><span style="color:#82AAFF;"> URL</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    url</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">searchParams</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 3</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Delegate with the modified URL</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#BABED8;"> url</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pathname</span><span style="color:#89DDFF;"> +</span><span style="color:#BABED8;"> url</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">search</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Post-process response before returning</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> headers</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> new</span><span style="color:#82AAFF;"> Headers</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">headers</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">X-Pipeline-Step</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> new</span><span style="color:#82AAFF;"> Response</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> status</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">status</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> headers</span><span style="color:#89DDFF;"> }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">┌──────────┐   ┌──────────────┐    ┌──────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ app</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">     │ → │ products</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">    │ →  │ stickers</span><span style="color:#89DDFF;">/?</span><span style="color:#BABED8;">p</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;">    │</span></span>
<span class="line"><span style="color:#BABED8;">│ handler  │   │ handler      │    │ handler          │</span></span>
<span class="line"><span style="color:#BABED8;">│ </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()   │ ← │ </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()       │    │ return </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;">        │</span></span>
<span class="line"><span style="color:#BABED8;">└──────────┘   └──────────────┘    └──────────────────┘</span></span></code></pre></div><p>Through this mechanism, Webflo lets handlers <strong>reshape requests or responses inline</strong>, without needing extra middleware layers or global hooks.</p><h2 id="the-client-server-flow" tabindex="-1">The Client-Server Flow <a class="header-anchor" href="#the-client-server-flow" aria-label="Permalink to &quot;The Client-Server Flow&quot;">​</a></h2><p>While the <strong>Delegation Model</strong> describes how a request flows through a <em>horizontal</em> route path (parent → child), the <strong>Client-Server Flow</strong> represents the <em>vertical</em> flow of the same request through the application stack (client → server).</p><p>Webflo follows a model that supports request handling and routing at all three layers in this stack: the browser window layer (<strong>client</strong>), the service worker layer (<strong>worker</strong>), the server layer (<strong>server</strong>).</p><p>Handlers fit into this stack by their filename suffix:</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">handler.client.js → Executes in the browser (first to see navigations)</span></span>
<span class="line"><span style="color:#BABED8;">handler.worker.js → Executes in the Service Worker (next in line)</span></span>
<span class="line"><span style="color:#BABED8;">handler.server.js → Executes on the server (last in line)</span></span>
<span class="line"><span style="color:#BABED8;">handler.js        → Executes anywhere (default handler)</span></span></code></pre></div><p>Together, these form a vertical routing pipeline.</p><p>Below is a conceptual diagram of how a navigation request flows donw the layers:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">┌─────────────┐   │   ┌─────────────────────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ </span><span style="color:#82AAFF;">navigate</span><span style="color:#BABED8;">()  │ → │ </span><span style="color:#89DDFF;">?</span><span style="color:#BABED8;"> │ handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">client</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js </span><span style="color:#89DDFF;">??</span><span style="color:#BABED8;"> handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js │</span></span>
<span class="line"><span style="color:#BABED8;">│             │ ← │   └─────────────────────────────────┘</span></span>
<span class="line"><span style="color:#BABED8;">│ app         │   │   ┌─────────────────────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">└─────────────┘   │ </span><span style="color:#89DDFF;">?</span><span style="color:#BABED8;"> │ handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">worker</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js </span><span style="color:#89DDFF;">??</span><span style="color:#BABED8;"> handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js │</span></span>
<span class="line"><span style="color:#BABED8;">                  │   └─────────────────────────────────┘</span></span>
<span class="line"><span style="color:#BABED8;">                  │   ┌─────────────────────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">                  │ </span><span style="color:#89DDFF;">?</span><span style="color:#BABED8;"> │ handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">server</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js </span><span style="color:#89DDFF;">??</span><span style="color:#BABED8;"> handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js │</span></span>
<span class="line"><span style="color:#BABED8;">                  ▼   └─────────────────────────────────┘</span></span></code></pre></div><p>Handlers are optional; if a level-specific file doesn’t exist, Webflo automatically falls back to the unsuffixed one <code>handler.js</code>, if defined. Otherwise, the request continues to the next layer. Each request gets a graceful path from local logic to remote fulfillment.</p><p>As with the horizontal flow, each layer may intercept, fulfill, or delegate down the request.<br> Handlers at higher layers (like the browser) are able to respond instantly or hand the request down the stack.</p><p>This model grants profound flexibility — enabling progressive enhancement, offline support, and universal routing, all through the same <code>next()</code> interface.</p><h3 id="layer-semantics" tabindex="-1">Layer Semantics <a class="header-anchor" href="#layer-semantics" aria-label="Permalink to &quot;Layer Semantics&quot;">​</a></h3><p>These layers are differentiated by various factors and use cases.</p><table tabindex="0"><thead><tr><th style="text-align:left;">Scope</th><th style="text-align:left;">Purpose</th><th style="text-align:left;">Typical Usage</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>handler.client.js</strong></td><td style="text-align:left;">Runs in the browser during navigation</td><td style="text-align:left;">SPA transitions, local data hydration</td></tr><tr><td style="text-align:left;"><strong>handler.worker.js</strong></td><td style="text-align:left;">Runs in the Service Worker</td><td style="text-align:left;">Offline caching, background synchronization</td></tr><tr><td style="text-align:left;"><strong>handler.server.js</strong></td><td style="text-align:left;">Runs on the server</td><td style="text-align:left;">Database queries, SSR, API endpoints</td></tr><tr><td style="text-align:left;"><strong>handler.js</strong></td><td style="text-align:left;">Fallback when no scope-specific handler exists</td><td style="text-align:left;">Shared logic or universal defaults</td></tr></tbody></table><h4 id="client-side-handlers" tabindex="-1">Client-Side Handlers <a class="header-anchor" href="#client-side-handlers" aria-label="Permalink to &quot;Client-Side Handlers&quot;">​</a></h4><p>Client handlers intercept navigations directly in the browser — the first layer that sees user-initiated requests.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/handler.client.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Access browser APIs freely</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> theme</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">theme</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Client Navigation</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> theme</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ul><li>Executes during in-app navigations (SPA behavior)</li><li>Runs within the already loaded document and has access to window</li><li>Can render instantly from local data or cache</li><li>Optionally calls <code>next()</code> to delegate the request</li></ul><div class="info custom-block"><p class="custom-block-title">Handler Lifecycle</p><ul><li>Client handlers begin their lifecycle <em>after</em> the initial page load.</li><li>They therefore cannot intercept the first page load or page reloads.</li></ul></div><h4 id="worker-side-handlers" tabindex="-1">Worker-Side Handlers <a class="header-anchor" href="#worker-side-handlers" aria-label="Permalink to &quot;Worker-Side Handlers&quot;">​</a></h4><p>Worker handlers run in the Service Worker context, bridging offline and network behavior. They are the connective tissue between local interactivity and remote resources.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/handler.worker.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Access Service Worker APIs</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> cache</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#BABED8;"> caches</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">webflo-assets</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> cached</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#BABED8;"> cache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">match</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">cached</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> cached</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> network</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // fallback to server</span></span>
<span class="line"><span style="color:#BABED8;">    cache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> network</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> network</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ul><li>Executes for same-origin requests</li><li>Can serve from cache, perform background syncs, or proxy network calls</li><li>Can delegates to the server when offline handling isn’t possible</li></ul><div class="info custom-block"><p class="custom-block-title">Handler Lifecycle</p><ul><li>Worker handlers start intercepting once the app’s Service Worker is installed and activated.</li><li>They therefore cannot intercept the very first page load that installs the app.</li><li>They continue working even when the page isn’t open, making them ideal for offline logic.</li></ul></div><h4 id="server-side-handlers" tabindex="-1">Server-Side Handlers <a class="header-anchor" href="#server-side-handlers" aria-label="Permalink to &quot;Server-Side Handlers&quot;">​</a></h4><p>Server handlers perform the heavy lifting — database queries, rendering, API endpoints, and integrations. They represent the final dynamic layer before static content resolution.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">env</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ADMIN_USER</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://api.example.com/stats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#BABED8;font-style:italic;">r</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#BABED8;"> r</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">Dashboard | </span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ul><li>Executes for HTTP requests that reach the server</li><li>Accesses environment variables and external APIs</li><li>May call <code>next()</code> to handoff request to Webflo’s static file layer</li></ul><h4 id="universal-handlers" tabindex="-1">Universal Handlers <a class="header-anchor" href="#universal-handlers" aria-label="Permalink to &quot;Universal Handlers&quot;">​</a></h4><p>Universal handlers (<code>handler.js</code>) are handlers declared without any layer binding. They can coexist with layer-specific handlers but execute wherever no layer-specific handler exists for the current layer, making them perfect for universal logic.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/handler.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Purely portable logic — no window, no caches, no env</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> message</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Handled by default</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Progressive Enhancement</p><ul><li>Because handlers are modular by filename, promoting a route from server-side to client-side is as simple as renaming the file.</li><li>Webflo’s model turns <em>progressive enhancement</em> into a first-class development workflow.</li></ul></div><h3 id="fall-through-behavior" tabindex="-1">Fall-Through Behavior <a class="header-anchor" href="#fall-through-behavior" aria-label="Permalink to &quot;Fall-Through Behavior&quot;">​</a></h3><p>If a handler calls <code>next()</code> and no deeper step exists in the current layer, Webflo <strong>falls through to the next layer</strong> in the stack. This continuity is built-in.</p><table tabindex="0"><thead><tr><th style="text-align:left;">Scope</th><th style="text-align:left;">Default Action when <code>next()</code> reaches edge</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>Client</strong></td><td style="text-align:left;">Falls through to the worker layer.</td></tr><tr><td style="text-align:left;"><strong>Worker</strong></td><td style="text-align:left;">Falls through to either: (cache → server) or (server → cache), depending on worker config.</td></tr><tr><td style="text-align:left;"><strong>Server</strong></td><td style="text-align:left;">Falls through to the static file layer <code>/public</code>; returns 404 if no match.</td></tr></tbody></table><p>This is simulated below for a navigation to <code>/products/stickers</code>, where the client and worker layers defer to the server for resolution.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/products/handler.client.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Defer to deeper layers</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">┌──────────┐   ┌──────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ app/     │ → │ products/    │─┐  (fall-through)</span></span>
<span class="line"><span style="color:#BABED8;">│ handler  │   │ handler      │ │</span></span>
<span class="line"><span style="color:#BABED8;">│ next()   │   │ next()       │ │</span></span>
<span class="line"><span style="color:#BABED8;">└──────────┘   └──────────────┘ │</span></span>
<span class="line"><span style="color:#BABED8;">                                │</span></span>
<span class="line"><span style="color:#BABED8;">                                │  (server layer)</span></span>
<span class="line"><span style="color:#BABED8;">                                ▼</span></span>
<span class="line"><span style="color:#BABED8;">┌──────────┐   ┌──────────────┐    ┌──────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ app/     │ → │ products/    │ →  │ stickers/        │</span></span>
<span class="line"><span style="color:#BABED8;">│ handler  │   │ handler      │    │ handler          │</span></span>
<span class="line"><span style="color:#BABED8;">│ next()   │   │ next()       │    │ return {}        │</span></span>
<span class="line"><span style="color:#BABED8;">└──────────┘   └──────────────┘    └──────────────────┘</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/products/stickers/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> ()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> result</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#BABED8;"> db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#89DDFF;">        \`</span><span style="color:#C3E88D;">SELECT * FROM products WHERE category = &#39;stickers&#39;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Stickers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> result</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>Here, the client and worker defer, the server handles the query, and the browser receives the composed response. This unlocks the full power of composition, progressive enhancement, and resilience per route — whether online, offline, or hybrid.</p><h2 id="flow-summary" tabindex="-1">Flow Summary <a class="header-anchor" href="#flow-summary" aria-label="Permalink to &quot;Flow Summary&quot;">​</a></h2><p>While your first handler is perfectly fine to fit routing logic into conditional blocks, Webflo&#39;s delegation model makes routing all seamsless as you go from a simple <em>Hello World</em> to a standard app, to a fully distributed system.</p><p>The delegation and composition model turns the traditional “server-first” web into a <strong>collaborative matrix</strong>. Each level decides what it can handle best and delegates what it cannot.</p><p>This composability and control extend to static files handling.</p><h2 id="static-files" tabindex="-1">Static Files <a class="header-anchor" href="#static-files" aria-label="Permalink to &quot;Static Files&quot;">​</a></h2><p>At the end of Webflo’s routing chain lies the <strong>static layer</strong> — a built-in static file server that operates by the same rules as every other layer.</p><p>In Webflo, static resolution is not a separate middleware; it is simply the final stage of the routing pipeline.</p><p>This layer is reached <strong>from the server routing layer</strong>, when:</p><ul><li>a server handler calls <code>next()</code> and no further route step exists in the pipeline</li></ul><p>Because static serving sits in this same flow, route handlers take first-seat complete control — to intercept, rewrite, or even <em>simulate</em> static responses before they are served.</p><p>This flow is simulated below for an image URL: <code>/img/logo.png</code> embedded on a page.<br> Its resolution goes the standard routing flow until matching a file in the <code>app/public</code> directory.</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">┌─────────────┐   │   ┌─────────────────────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">│ </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#C792EA;"> src</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">   │ → │ ? │ handler.client.js ?? handler.js │</span></span>
<span class="line"><span style="color:#BABED8;">│             │ ← │   └─────────────────────────────────┘</span></span>
<span class="line"><span style="color:#BABED8;">│ app         │   │   ┌─────────────────────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">└─────────────┘   │ ? │ handler.worker.js ?? handler.js │</span></span>
<span class="line"><span style="color:#BABED8;">                  │   └─────────────────────────────────┘</span></span>
<span class="line"><span style="color:#BABED8;">                  │   ┌─────────────────────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">                  │ ? │ handler.server.js ?? handler.js │</span></span>
<span class="line"><span style="color:#BABED8;">                  │   └─────────────────────────────────┘</span></span>
<span class="line"><span style="color:#BABED8;">                  │   ┌─────────────────────────────────┐</span></span>
<span class="line"><span style="color:#BABED8;">                  │ ? │ public/img/pic.png              │</span></span>
<span class="line"><span style="color:#BABED8;">                  │   │ public/img/banner.png           │</span></span>
<span class="line"><span style="color:#BABED8;">                  │   │ public/img/logo.png             │</span></span>
<span class="line"><span style="color:#BABED8;">                  ▼   └─────────────────────────────────┘</span></span></code></pre></div><p>Each handler along the flow gets a chance to intercept the request.<br> A worker, for example, may serve a cached image or synthesize a response. A server handler may rewrite the path before handing off to <code>/public</code> or it may <em>gate</em> or authenticate the request before passing it on.</p><p>This handler-first approach to static files serving ensures that asset delivery fits your application logic, authentication, or cache policies.</p><p>But this also requires <strong>proper delegation discipline</strong> by handlers. Handlers must consciously call <code>next()</code> for requests they&#39;re not explicitly designed to handle.</p><p>Overall, by merging dynamic logic and static delivery into one continuous flow, Webflo replaces special-case asset middleware with a <strong>first-class, programmable static pipeline</strong>.</p><h3 id="default-resolution" tabindex="-1">Default Resolution <a class="header-anchor" href="#default-resolution" aria-label="Permalink to &quot;Default Resolution&quot;">​</a></h3><p>When a request reaches the static layer, Webflo performs deterministic file resolution:</p><ol><li>Look for a file in <code>/public</code> matching the request path.</li><li>If found, serve it with correct headers (e.g. <code>Content-Type</code>, <code>Content-Length</code>, caching).</li><li>If not found, return <code>404</code>.</li></ol><h2 id="use-case-patterns" tabindex="-1">Use Case Patterns <a class="header-anchor" href="#use-case-patterns" aria-label="Permalink to &quot;Use Case Patterns&quot;">​</a></h2><p>The following examples demonstrate how Webflo’s routing primitives—delegation, composition, and explicit fall-through—combine to express real application structures. Each pattern is an applied scenario that builds directly on the models we’ve covered so far.</p><h3 id="parent–child-composition" tabindex="-1">Parent–Child Composition <a class="header-anchor" href="#parent–child-composition" aria-label="Permalink to &quot;Parent–Child Composition&quot;">​</a></h3><p><strong>Scenario:</strong> A parent route prepares context and then delegates to a child, merging its result. This pattern allows <em>layered composition</em>—logic in parents, data or view in children.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> context</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">        const</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> getSessionUser</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">        const</span><span style="color:#BABED8;"> childResult</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;"> }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> {</span><span style="color:#89DDFF;"> ...</span><span style="color:#BABED8;">childResult</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> \`\${</span><span style="color:#BABED8;">childResult</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">title</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> | ExampleApp</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Home</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>Takeaway:</strong> Each handler can frame or extend downstream results, making cross-cutting concerns like authentication or analytics fully composable.</p><h3 id="internal-api-consumption" tabindex="-1">Internal API Consumption <a class="header-anchor" href="#internal-api-consumption" aria-label="Permalink to &quot;Internal API Consumption&quot;">​</a></h3><p><strong>Scenario:</strong> A page handler calls an internal API route using <code>next(path)</code> instead of making an HTTP request. This lets server code reuse API logic without duplication or latency.</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">app/</span></span>
<span class="line"><span style="color:#BABED8;">├── api/</span></span>
<span class="line"><span style="color:#BABED8;">│   └── products/handler.server.js</span></span>
<span class="line"><span style="color:#BABED8;">└── shop/handler.server.js</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/shop/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> products</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> title</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Shop</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> ...</span><span style="color:#BABED8;">products</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>Takeaway:</strong> By re-entering the routing pipeline locally, Webflo turns API composition into simple function calls—no network, no boilerplate.</p><h3 id="auth-guard" tabindex="-1">Auth Guard <a class="header-anchor" href="#auth-guard" aria-label="Permalink to &quot;Auth Guard&quot;">​</a></h3><p><strong>Scenario:</strong> A parent route gates access for its children, redirecting unauthenticated users and passing context when authorized.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/account/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> context</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> getUserFromSession</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> new</span><span style="color:#82AAFF;"> Response</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null,</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> status</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 302</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> headers</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> Location</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">/login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> }</span><span style="color:#89DDFF;"> }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;"> ...</span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;"> }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>Takeaway:</strong> Authentication becomes just another layer in the routing flow—no external middleware required.</p><h3 id="file-guards-and-access-control" tabindex="-1">File Guards and Access Control <a class="header-anchor" href="#file-guards-and-access-control" aria-label="Permalink to &quot;File Guards and Access Control&quot;">​</a></h3><p><strong>Scenario:</strong> Restrict access to premium or user-specific files before they reach the static layer.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/files/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> getUserFromSession</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">isPremium</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> new</span><span style="color:#82AAFF;"> Response</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access denied</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> status</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 403</span><span style="color:#89DDFF;"> }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>Takeaway:</strong> Because static requests flow through the same pipeline, permission checks and audit logic integrate naturally with asset delivery.</p><h3 id="dynamic-file-serving" tabindex="-1">Dynamic File Serving <a class="header-anchor" href="#dynamic-file-serving" aria-label="Permalink to &quot;Dynamic File Serving&quot;">​</a></h3><p><strong>Scenario:</strong> Rewrite or transform static responses on the fly for caching, personalization, or instrumentation.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/-/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // delegate to /public</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;"> &amp;&amp;</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ok</span><span style="color:#89DDFF;"> &amp;&amp;</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text/html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">        const</span><span style="color:#BABED8;"> headers</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> new</span><span style="color:#82AAFF;"> Headers</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">headers</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Cache-Control</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">public, max-age=300</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">X-Served-By</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Webflo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#89DDFF;"> new</span><span style="color:#82AAFF;"> Response</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {</span><span style="color:#F07178;"> status</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">status</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> headers</span><span style="color:#89DDFF;"> }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>Takeaway:</strong> Handlers can shape even static responses—embedding application-level awareness into the file server itself.</p><h3 id="full-stack-routing" tabindex="-1">Full-Stack Routing <a class="header-anchor" href="#full-stack-routing" aria-label="Permalink to &quot;Full-Stack Routing&quot;">​</a></h3><p><strong>Scenario:</strong> A single navigation passes through multiple layers—client, worker, server, static—each adding incremental behavior.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">CLIENT</span><span style="color:#BABED8;"> (handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">client</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js)</span></span>
<span class="line"><span style="color:#BABED8;">    │   Intercepted navigation</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> local cache check</span></span>
<span class="line"><span style="color:#BABED8;">    ▼   </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">WORKER</span><span style="color:#BABED8;"> (handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">worker</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js)</span></span>
<span class="line"><span style="color:#BABED8;">    │   Offline fallback or cache refresh</span></span>
<span class="line"><span style="color:#BABED8;">    ▼   </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">SERVER</span><span style="color:#BABED8;"> (handler</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">server</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">js)</span></span>
<span class="line"><span style="color:#BABED8;">    │   Query</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> render</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> compose</span></span>
<span class="line"><span style="color:#BABED8;">    ▼   </span><span style="color:#82AAFF;">next</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">STATIC</span><span style="color:#BABED8;"> (public</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">    │   Fallback to static asset</span></span>
<span class="line"><span style="color:#BABED8;">    ▼</span></span>
<span class="line"><span style="color:#BABED8;">  Response returned</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/products/handler.client.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stepname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Attempt to serve from local state</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> cached</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">products</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">cached</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">cached</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // defer to worker/server</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>Takeaway:</strong> Full-stack routing enables progressive enhancement by design—each scope adds value without breaking continuity.</p><h3 id="remote-procedure-calls-clone" tabindex="-1">Remote Procedure Calls Clone <a class="header-anchor" href="#remote-procedure-calls-clone" aria-label="Permalink to &quot;Remote Procedure Calls Clone&quot;">​</a></h3><p><strong>Scenario:</strong> Think of Webflo’s routing pipeline as RPC with spatial awareness. Each <code>next()</code> is a local procedure call that moves closer to the data or resource in question.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app/dashboard/handler.server.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#89DDFF;font-style:italic;"> default</span><span style="color:#C792EA;"> async</span><span style="color:#C792EA;"> function</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> metrics</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/metrics</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> reports</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> next</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/reports</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    return</span><span style="color:#89DDFF;"> {</span><span style="color:#BABED8;"> metrics</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> reports</span><span style="color:#89DDFF;"> };</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>Takeaway:</strong> Unlike traditional RPC, routing in Webflo preserves URL semantics and context propagation while keeping the call local and synchronous.</p><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>Webflo’s routing system unifies <strong>filesystem mapping</strong>, <strong>functional composition</strong>, and <strong>layered execution</strong> into one consistent model.</p><ul><li>The filesystem defines your application structure.</li><li>Handlers define logic for each URL segment.</li><li><code>next()</code> controls flow between steps and scopes.</li><li>Default fallbacks ensure graceful completion through the stack.</li><li>Static serving is part of the same flow, enabling dynamic control.</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">​</a></h2><ul><li><a href="./rendering">Rendering</a>: How handler data becomes UI.</li><li><a href="./templates">Templates</a>: Composing reusable HTML layouts.</li><li><a href="./state">State &amp; Reactivity</a>: Managing state and mutation across requests.</li></ul>`,144)])])}const d=a(o,[["render",t]]);export{F as __pageData,d as default};
